‚úÖ –ö–ê–ö –ü–†–ê–í–ò–õ–¨–ù–û –£–ü–†–ê–í–õ–Ø–¢–¨ –ë–û–¢–û–ú –í –¢–í–û–ï–ô –°–•–ï–ú–ï
‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç
sudo supervisorctl start naumrabota-bot

‚èπ –û—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo supervisorctl stop naumrabota-bot

üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo supervisorctl restart naumrabota-bot

üìä –°—Ç–∞—Ç—É—Å
sudo supervisorctl status

üìú –õ–æ–≥–∏ (–∞–Ω–∞–ª–æ–≥ journalctl)
sudo supervisorctl tail -f naumrabota-bot


Webhook:

sudo supervisorctl tail -f naumrabota-webhook




1. SUPERVISOR ‚Äî –û–°–ù–û–í–ù–û–ô –ê–í–¢–û–ó–ê–ü–£–°–ö (–£ –¢–ï–ë–Ø –£–ñ–ï –ï–°–¢–¨)

–¢—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Supervisor ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä.

1.1 –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Supervisor –≤–∫–ª—é—á—ë–Ω –≤ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
systemctl status supervisor


–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:

Active: active (running)
Loaded: enabled


–ï—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–µ enabled:

sudo systemctl enable supervisor
sudo systemctl start supervisor

1.2 –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
/etc/supervisor/conf.d/naumrabota-bot.conf
[program:naumrabota-bot]
command=/opt/naumrabota/venv/bin/python -m bot.main
directory=/opt/naumrabota
autostart=true
autorestart=true
startretries=10
stderr_logfile=/var/log/naumrabota/bot.err.log
stdout_logfile=/var/log/naumrabota/bot.out.log
environment=PATH="/opt/naumrabota/venv/bin"

/etc/supervisor/conf.d/naumrabota-webhook.conf
[program:naumrabota-webhook]
command=/opt/naumrabota/venv/bin/uvicorn bot.webhook:app --host 127.0.0.1 --port 8001
directory=/opt/naumrabota
autostart=true
autorestart=true
startretries=10
stderr_logfile=/var/log/naumrabota/webhook.err.log
stdout_logfile=/var/log/naumrabota/webhook.out.log
environment=PATH="/opt/naumrabota/venv/bin"

1.3 –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Supervisor
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl status


–û–∂–∏–¥–∞–µ–º–æ:

naumrabota-bot      RUNNING
naumrabota-webhook  RUNNING

üåê 2. NGINX ‚Äî –ê–í–¢–û–ó–ê–ü–£–°–ö –ò –ó–ê–©–ò–¢–ê
2.1 –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ nginx
systemctl is-enabled nginx


–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:

enabled


–ï—Å–ª–∏ –Ω–µ—Ç:

sudo systemctl enable nginx

2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Ä–µ–±—É—Ç–∞ (–∫–ª—é—á–µ–≤–∞—è)
reboot


–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞:

sudo supervisorctl status
curl https://naumrabota.ru/health


–ï—Å–ª–∏:

RUNNING

{"status":"ok"}

üëâ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%

üîê 3. SSL / CERTBOT ‚Äî –ê–í–¢–û–ü–†–û–î–õ–ï–ù–ò–ï

Certbot —É —Ç–µ–±—è —É–∂–µ –ø–æ—Å—Ç–∞–≤–∏–ª —Ç–∞–π–º–µ—Ä.

–ü—Ä–æ–≤–µ—Ä–∫–∞:

systemctl list-timers | grep certbot


–î–æ–ª–∂–µ–Ω –±—ã—Ç—å certbot.timer.

–†—É—á–Ω–æ–π —Ç–µ—Å—Ç:

sudo certbot renew --dry-run


–ï—Å–ª–∏ –±–µ–∑ –æ—à–∏–±–æ–∫ ‚Äî SSL –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π.

üì¶ 4. –õ–û–ì–ò ‚Äî –ß–¢–û –°–ú–û–¢–†–ï–¢–¨ –ü–†–ò –°–ë–û–Ø–•
–ë–æ—Ç:
sudo supervisorctl tail -f naumrabota-bot

Webhook:
sudo supervisorctl tail -f naumrabota-webhook

Nginx:
sudo tail -f /var/log/nginx/error.log